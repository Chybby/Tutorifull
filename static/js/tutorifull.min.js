function createElement(a,b){var c=document.createElement(a);return b&&(c.className=b),c}function httpGetAsync(a,b){var c=new XMLHttpRequest;c.onreadystatechange=function(){4==c.readyState&&200==c.status&&b(c.responseText)},c.open("GET",a,!0),c.send(null)}function searchCourses(){var a=this.value;""==a?courseSearchResults.innerHTML="":httpGetAsync("/courses?q="+a,courseSearchResultsCallback)}function onSearchBoxClick(){this.setSelectionRange(0,this.value.length)}function courseSearchResultsCallback(a){var a=JSON.parse(a);courseSearchResults.innerHTML="",a.forEach(function(a){var b=createElement("li","course-search-result");b.textContent=a.course_id+" - "+a.course_name,b.dataset.courseId=a.course_id,b.onclick=onCourseSearchResultClick,courseSearchResults.appendChild(b)})}function onCourseSearchResultClick(){httpGetAsync("/courses/"+this.dataset.courseId,classSearchResultsCallback),courseSearchResults.innerHTML="",searchBox.value=this.textContent}function classSearchResultsCallback(a){var a=JSON.parse(a);classSearchResults.innerHTML="",searchedClassRows.clear();var b=createElement("table","course-table"),c=createElement("caption","course-table-title");c.textContent=a.course_id,b.appendChild(c),a.classes.forEach(function(c){var d=createElement("tr","class-table-row row");d.dataset.classId=c.class_id,d.dataset.courseId=a.course_id,selectedClassRows.has(d.dataset.classId)&&(d.className="class-table-row row selected"),d.onclick=onSearchedClassClick;var e=createElement("td","class-table-data class-type");e.textContent=c.type,e.dataset.type=c.type,d.appendChild(e);var f=createElement("td","class-table-data class-time");null!=c.day&&(f.textContent=c.day+" "+c.start_time+"-"+c.end_time,e.dataset.day=c.day,e.dataset.startTime=c.start_time,e.dataset.endTime=c.end_time),d.appendChild(f);var g=createElement("td","class-table-data class-location");g.textContent=c.location,g.dataset.location=c.location,d.appendChild(g);var h=createElement("td","class-table-data class-status");h.textContent=c.status,h.dataset.status=c.status,d.appendChild(h);var i=createElement("td","class-table-data class-enrolled");i.textContent=c.enrolled+"/"+c.capacity,i.dataset.enrolled=c.enrolled,i.dataset.capacity=c.capacity,i.dataset.percentage=c.percentage,console.log(c),100==c.percentage?i.classList.add("full"):c.percentage>=80&&i.classList.add("almost-full"),d.appendChild(i),b.appendChild(d),searchedClassRows.set(d.dataset.classId,d)}),classSearchResults.appendChild(b)}function checkSelectedCourseTableEmpty(a){var b=selectedCourseTables.get(a);0==b.getElementsByTagName("tr").length&&(selectedCourseTables["delete"](a),b.remove())}function onSearchedClassClick(){if(this.classList.toggle("selected"),selectedClassRows.has(this.dataset.classId))selectedClassRows.get(this.dataset.classId).remove(),checkSelectedCourseTableEmpty(this.dataset.courseId),selectedClassRows["delete"](this.dataset.classId);else{0==selectedClassRows.size&&(confirmClasses.innerHTML=""),selectedClassRows.set(this.dataset.classId,this);var a;if(selectedCourseTables.has(this.dataset.courseId))a=selectedCourseTables.get(this.dataset.courseId);else{a=createElement("table","course-table"),selectedCourseTables.set(this.dataset.courseId,a);var b=createElement("caption","course-table-title");b.textContent=this.dataset.courseId,a.appendChild(b),confirmClasses.appendChild(a)}var c=this.cloneNode(deep=!0);c.onclick=onSelectedClassClick,a.appendChild(c),selectedClassRows.set(this.dataset.classId,c)}}function onSelectedClassClick(){this.remove(),checkSelectedCourseTableEmpty(this.dataset.courseId),selectedClassRows["delete"](this.dataset.classId),searchedClassRows.has(this.dataset.classId)&&searchedClassRows.get(this.dataset.classId).classList.toggle("selected")}function clearOtherContactInputs(){var a=this;Array.prototype.forEach.call(contactInputs,function(b){b!=a&&(b.value="")})}var searchBox=document.getElementsByClassName("search-box")[0],courseSearchResults=document.getElementsByClassName("course-search-results")[0],classSearchResults=document.getElementsByClassName("class-search-results")[0],contactInputs=document.getElementsByClassName("contact-input-box"),confirmClasses=document.getElementsByClassName("confirm-classes")[0],searchedClassRows=new Map,selectedCourseTables=new Map,selectedClassRows=new Map;searchBox.onkeyup=searchCourses,searchBox.onclick=onSearchBoxClick,Array.prototype.forEach.call(contactInputs,function(a){a.onkeyup=clearOtherContactInputs}),document.getElementsByClassName("alert-me-button")[0].onclick=function(){var a={};Array.prototype.forEach.call(contactInputs,function(b){b.value&&(a[b.name]=b.value)}),a.classids=Array.from(selectedClassRows.keys());var b=new XMLHttpRequest;b.open("post","/alerts",!0),b.setRequestHeader("Content-Type","application/json; charset=UTF-8"),b.send(JSON.stringify(a)),b.onloadend=function(a){document.write(a.target.response),window.scrollTo(0,0)}};